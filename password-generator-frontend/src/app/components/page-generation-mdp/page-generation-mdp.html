<div class="password-display">
  <div class="password-text" [class.password-animating]="passwordAnimating">{{ generatedPassword }}</div>
  <div class="password-actions">
    <p-button label="Copier" class="copy-button" (click)="copyPassword()"/>
    <mat-icon class="refresh-icon" (click)="generatePassword()">autorenew</mat-icon>
    <mat-icon class="like-icon" (click)="savePassword()">
      {{ liked ? 'favorite' : 'favorite_border' }}
    </mat-icon>
  </div>
</div>

<div class="mode-switcher">
  <div class="custom-select-container">
    <button class="custom-mode-btn" [class.active]="generationMode === 'random'" (click)="generationMode = 'random'">Aléatoire</button>
    <button class="custom-mode-btn" [class.active]="generationMode === 'ai'" (click)="generationMode = 'ai'">IA</button>
  </div>
</div>

<div class="settings-container" *ngIf="generationMode === 'random'">
  <div class="slider-container">
    <div class="slider-wrapper">
      <p-slider [(ngModel)]="lengthMdp" [min]="4" [max]="40" [step]="1" (onChange)="onSliderChange()" class="slider" />
      <div class="slider-value-label" [style.left.%]="getSliderPosition()">
        {{ lengthMdp }}
      </div>
    </div>
  </div>
  <div class="checkbox-container">
    <div class="checkbox-item">
      <p-checkbox [(ngModel)]="includeLetters" [binary]="true" inputId="letters" (onChange)="onCheckboxChange('letters')" [disabled]="isCheckboxDisabled('letters')" />
      <label for="letters" class="label-container">
        <span class="label-text">Lettres</span>
        <span class="label-example">(a-z, A-Z)</span>
      </label>
    </div>
    <div class="checkbox-item">
      <p-checkbox [(ngModel)]="includeNumbers" [binary]="true" inputId="numbers" (onChange)="onCheckboxChange('numbers')" [disabled]="isCheckboxDisabled('numbers')" />
      <label for="numbers" class="label-container">
        <span class="label-text">Chiffres</span>
        <span class="label-example">(0-9)</span>
      </label>
    </div>
    <div class="checkbox-item">
      <p-checkbox [(ngModel)]="includeSymbols" [binary]="true" inputId="symbols" (onChange)="onCheckboxChange('symbols')" [disabled]="isCheckboxDisabled('symbols')" />
      <label for="symbols" class="label-container">
        <span class="label-text">Symboles</span>
        <span class="label-example">(!@#$...)</span>
      </label>
    </div>
    <div class="checkbox-item">
      <p-checkbox [(ngModel)]="includeSimilar" [binary]="true" inputId="similar" (onChange)="onCheckboxChange('similar')" [disabled]="isCheckboxDisabled('similar')" />
      <label for="similar" class="label-container">
        <span class="label-text">Caractères similaires</span>
        <span class="label-example">(i, l, 1, L, o, 0, O)</span>
      </label>
    </div>
  </div>
</div>

<p-dialog header="Sauvegarder le mot de passe" [(visible)]="displaySaveDialog" [modal]="true" [style]="{width: '400px'}">
  <div class="p-fluid">
    <div class="field">
      <label for="serviceName">Nom du service</label>
      <input pInputText id="serviceName" [(ngModel)]="serviceName" placeholder="Ex: Facebook, Gmail..." autofocus />
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button label="Annuler" icon="pi pi-times" (click)="displaySaveDialog = false" styleClass="p-button-text"></p-button>
    <p-button label="Sauvegarder" icon="pi pi-check" (click)="confirmSavePassword()" [disabled]="!serviceName"></p-button>
  </ng-template>
</p-dialog>

<p-dialog header="Confirmation" [(visible)]="displayDeleteDialog" [modal]="true" [style]="{width: '400px'}">
  <div class="confirmation-content">
    <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
    <span>Voulez-vous vraiment supprimer ce mot de passe ?</span>
  </div>
  <ng-template pTemplate="footer">
    <p-button label="Non" icon="pi pi-times" (click)="displayDeleteDialog = false" styleClass="p-button-text"></p-button>
    <p-button label="Oui" icon="pi pi-check" (click)="deleteSavedPassword()" styleClass="p-button-danger"></p-button>
  </ng-template>
</p-dialog>
<div class="ai-container" *ngIf="generationMode === 'ai'">
  <input type="text" pInputText [(ngModel)]="userPrompt" placeholder="Entrez une phrase pour générer un mot de passe..." class="ai-input" (keydown.enter)="generateAiPassword()" />
  <p-button label="Générer" (click)="generateAiPassword()" [loading]="isGeneratingAi"></p-button>
</div>

<div class="leak-info" *ngIf="pwnedInfo">
  <div *ngIf="pwnedInfo.pwned" class="leak-warning">
    <mat-icon>warning</mat-icon>
    <span>Ce mot de passe a été trouvé {{ pwnedInfo.count }} fois dans des fuites de données !</span>
  </div>
  <div *ngIf="!pwnedInfo.pwned" class="leak-success">
    <mat-icon>check_circle</mat-icon>
    <span>Ce mot de passe n'a pas été trouvé dans les fuites de données connues.</span>
  </div>
</div>
